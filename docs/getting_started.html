
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Getting Started &#8212; Geometricus 0.0.1-dev documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api/modules.html" />
    <link rel="prev" title="Installing Geometricus" href="install.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/geometricus_logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Fast, structure-based, alignment-free protein embedding</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=TurtleTools&repo=geometricus&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Geometricus</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Structural-fragmentation">Structural fragmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-an-Embedding-from-Structural-Fragments">Generating an Embedding from Structural Fragments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Embedding-for-Dimensionality-Reduction">Embedding for Dimensionality Reduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Embedding-for-Supervised-Learning">Embedding for Supervised Learning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Finding-predictive-residues-and-structural-fragments">Finding predictive residues and structural fragments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="install.html" title="previous chapter">Installing Geometricus</a></li>
      <li>Next: <a href="api/modules.html" title="next chapter">API Reference</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="section" id="Getting-Started">
<h1>Getting Started<a class="headerlink" href="#Getting-Started" title="Permalink to this headline">¶</a></h1>
<p>Let’s walk through an example application of Geometricus in machine learning using a dataset of human MAP kinases, divided into three classes - JNK, Erk, and p38 kinases. This dataset was generated from the <a class="reference external" href="https://klifs.vu-compmedchem.nl/index.php">Kinase-Ligand Interaction Fingerprints and Structures database (KLIFS)</a> (Raw table <a class="reference external" href="../../example_data/MAPK_KLIFS.tsv">here</a>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pnd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/TurtleTools/geometricus/master/example_data/MAPK_KLIFS.tsv&quot;</span>
<span class="n">mapk_df</span> <span class="o">=</span> <span class="n">pnd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">mapk_pdb_id_to_class</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">pdb_id</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mapk_df</span><span class="p">[</span><span class="s2">&quot;PDB&quot;</span><span class="p">],</span> <span class="n">mapk_df</span><span class="p">[</span><span class="s2">&quot;CHAIN&quot;</span><span class="p">],</span> <span class="n">mapk_df</span><span class="p">[</span><span class="s2">&quot;CLASS&quot;</span><span class="p">])):</span>
    <span class="n">mapk_pdb_id_to_class</span><span class="p">[(</span><span class="n">pdb_id</span><span class="p">,</span> <span class="n">chain</span><span class="p">)]</span> <span class="o">=</span> <span class="n">class_name</span>
<span class="nb">len</span><span class="p">(</span><span class="n">mapk_pdb_id_to_class</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
527
</pre></div></div>
</div>
<p>So now we have a list of (PDB ID, chain) pairs, each associated with a class</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mapk_pdb_id_to_class</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">class_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;JNK&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Erk&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;p38&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_mapping</span><span class="p">[</span><span class="n">mapk_pdb_id_to_class</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">X_names</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="Structural-fragmentation">
<h2>Structural fragmentation<a class="headerlink" href="#Structural-fragmentation" title="Permalink to this headline">¶</a></h2>
<p>We consider two different ways of dividing a protein with <span class="math notranslate nohighlight">\(l\)</span> residues into structural fragments, a <span class="math notranslate nohighlight">\(k\)</span>-mer-based approach and a radius-based approach. For each structural fragment, multiple rotation and translation-invariant moments can be calculated. While the <span class="math notranslate nohighlight">\(k\)</span>-mer based approach is effective in describing structural fragments that are sequential in nature, such as <span class="math notranslate nohighlight">\(\alpha\)</span>-helices and loops, the radius-based approach can capture long-range structural contacts as
seen in <span class="math notranslate nohighlight">\(\beta\)</span>-sheets, as well as distinct interaction patterns in space, as found in enzyme active sites.</p>
<p>Below we fetch and parse each protein as a ProDy AtomGroup object. This takes a while (around 15 mins) since it downloads via FTP from RCSB.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">prody</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">pdbs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pdb_id</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> proteins fetched in </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="n">pdbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">pdb_id</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
50 proteins fetched in 96.46 seconds
100 proteins fetched in 194.62 seconds
150 proteins fetched in 281.02 seconds
200 proteins fetched in 365.41 seconds
250 proteins fetched in 448.01 seconds
300 proteins fetched in 534.71 seconds
350 proteins fetched in 613.16 seconds
400 proteins fetched in 692.71 seconds
450 proteins fetched in 777.41 seconds
500 proteins fetched in 861.82 seconds
</pre></div></div>
</div>
<p>Moment invariants can be calculated using the <code class="docutils literal notranslate"><span class="pre">geometricus.MomentInvariants</span></code> class. This class has many constructors, such as the <code class="docutils literal notranslate"><span class="pre">from_prody_atomgroup</span></code> below. This can be replaced by <code class="docutils literal notranslate"><span class="pre">from_pdb_file</span></code> to load a protein from a file or even <code class="docutils literal notranslate"><span class="pre">from_pdb_id</span></code> to download from RCSB via FTP.</p>
<p>This is the point where you decide the type and size of structural fragmentation to use. The options are:</p>
<ul class="simple">
<li><p>KMER - each residue is taken as the center of a kmer of length <code class="docutils literal notranslate"><span class="pre">split_size</span></code>, ends are included but shorter</p></li>
<li><p>RADIUS - overlapping spheres of radius <code class="docutils literal notranslate"><span class="pre">split_size</span></code></p></li>
<li><p>RADIUS_UPSAMPLE - upsamples backbone atoms before taking overlapping spheres.</p></li>
<li><p>KMER_CUT - same as kmer but ends are not included, only fragments of length <code class="docutils literal notranslate"><span class="pre">split_size</span></code> are kept</p></li>
<li><p>ALLMER - adds kmers of different lengths (<code class="docutils literal notranslate"><span class="pre">split_size</span> <span class="pre">-</span> <span class="pre">5</span></code> to <code class="docutils literal notranslate"><span class="pre">split_size</span> <span class="pre">+</span> <span class="pre">5</span></code>) to take into account deletions/insertions that don’t change the shape</p></li>
</ul>
<p>Below we use <code class="docutils literal notranslate"><span class="pre">SplitType.KMER</span></code> with a <code class="docutils literal notranslate"><span class="pre">split_size</span></code> (i.e. kmer size) of 16 and <code class="docutils literal notranslate"><span class="pre">SplitType.RADIUS</span></code> with a <code class="docutils literal notranslate"><span class="pre">split_size</span></code> (i.e. radius) of 10.</p>
<p><code class="docutils literal notranslate"><span class="pre">geometricus.MomentType</span></code> lists the available moment invariants. By default <span class="math notranslate nohighlight">\(O_3\)</span>, <span class="math notranslate nohighlight">\(O_4\)</span>, <span class="math notranslate nohighlight">\(O_5\)</span>, and <span class="math notranslate nohighlight">\(F\)</span> are calculated. This can be changed using the <code class="docutils literal notranslate"><span class="pre">moment_types</span></code> argument in any of the <code class="docutils literal notranslate"><span class="pre">MomentInvariants</span></code> constructors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">geometricus</span> <span class="kn">import</span> <span class="n">MomentInvariants</span><span class="p">,</span> <span class="n">SplitType</span>

<span class="n">invariants_kmer</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">invariants_radius</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> proteins in </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="n">invariants_kmer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MomentInvariants</span><span class="o">.</span><span class="n">from_prody_atomgroup</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">pdbs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">split_type</span><span class="o">=</span><span class="n">SplitType</span><span class="o">.</span><span class="n">KMER</span><span class="p">,</span> <span class="n">split_size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">invariants_radius</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MomentInvariants</span><span class="o">.</span><span class="n">from_prody_atomgroup</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">pdbs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">split_type</span><span class="o">=</span><span class="n">SplitType</span><span class="o">.</span><span class="n">RADIUS</span><span class="p">,</span> <span class="n">split_size</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
50 proteins in 3.42 seconds
100 proteins in 8.67 seconds
150 proteins in 15.67 seconds
200 proteins in 20.08 seconds
250 proteins in 25.12 seconds
300 proteins in 29.88 seconds
350 proteins in 33.77 seconds
400 proteins in 38.55 seconds
450 proteins in 43.29 seconds
500 proteins in 45.82 seconds
</pre></div></div>
</div>
</div>
<div class="section" id="Generating-an-Embedding-from-Structural-Fragments">
<h2>Generating an Embedding from Structural Fragments<a class="headerlink" href="#Generating-an-Embedding-from-Structural-Fragments" title="Permalink to this headline">¶</a></h2>
<p>Moment invariants are discretized into shape-mers, using a <strong>resolution</strong> parameter which controls how coarse or fine-grained this discretization is. A count vector of shape-mers is calculated for each protein with each element recording the number of times the corresponding shape-mer appears in that protein. The resolution parameter can be optimized to the task at hand. Generally, more divergent proteins would require a lower resolution while highly similar proteins would need higher
resolutions to differentiate them. For the MAP kinases, we use a relatively high resolution of 2.</p>
<p>Depending on the use-case you may want to embed all proteins at once, as demonstrated below, or separate train and test proteins as demonstrated in the Supervised Learning section.</p>
<div class="section" id="Embedding-for-Dimensionality-Reduction">
<h3>Embedding for Dimensionality Reduction<a class="headerlink" href="#Embedding-for-Dimensionality-Reduction" title="Permalink to this headline">¶</a></h3>
<p>Embeddings across all proteins can be used for dimensionality reduction and visualization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">umap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">geometricus</span> <span class="kn">import</span> <span class="n">GeometricusEmbedding</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">kmer_embedder</span> <span class="o">=</span> <span class="n">GeometricusEmbedding</span><span class="o">.</span><span class="n">from_invariants</span><span class="p">(</span><span class="n">invariants_kmer</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">radius_embedder</span> <span class="o">=</span> <span class="n">GeometricusEmbedding</span><span class="o">.</span><span class="n">from_invariants</span><span class="p">(</span><span class="n">invariants_radius</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated embeddings in </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

<span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">reduced</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">kmer_embedder</span><span class="o">.</span><span class="n">embedding</span><span class="p">,</span> <span class="n">radius_embedder</span><span class="o">.</span><span class="n">embedding</span><span class="p">)))</span>

<span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;JNK&quot;</span><span class="p">,</span> <span class="s2">&quot;Erk&quot;</span><span class="p">,</span> <span class="s2">&quot;p38&quot;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reduced</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">reduced</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">class_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generated embeddings in 1.19 seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/getting_started_11_1.png" src="_images/getting_started_11_1.png" />
</div>
</div>
</div>
<div class="section" id="Embedding-for-Supervised-Learning">
<h3>Embedding for Supervised Learning<a class="headerlink" href="#Embedding-for-Supervised-Learning" title="Permalink to this headline">¶</a></h3>
<p>Supervised learning, be it classification or regression, requires some form of training and test set separation. Below, the shape-mers used for embedding are calculated from the training set (using the kmer approach) and only those shape-mers are counted in the test proteins.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train_names</span><span class="p">,</span> <span class="n">X_test_names</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_names</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">train_embedder</span> <span class="o">=</span> <span class="n">GeometricusEmbedding</span><span class="o">.</span><span class="n">from_invariants</span><span class="p">(</span><span class="n">invariants_kmer</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">protein_keys</span><span class="o">=</span><span class="n">X_train_names</span><span class="p">)</span>
<span class="n">test_embedder</span> <span class="o">=</span> <span class="n">train_embedder</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">invariants_kmer</span><span class="p">,</span> <span class="n">X_test_names</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_embedder</span><span class="o">.</span><span class="n">embedding</span><span class="p">,</span> <span class="n">test_embedder</span><span class="o">.</span><span class="n">embedding</span>
</pre></div>
</div>
</div>
<p>For this simple problem, a decision tree classifier is more than enough to obtain good accuracy.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">class_names</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
              precision    recall  f1-score   support

         JNK       0.84      0.93      0.89        29
         Erk       0.93      0.89      0.91        46
         p38       0.95      0.94      0.95        84

    accuracy                           0.92       159
   macro avg       0.91      0.92      0.91       159
weighted avg       0.93      0.92      0.92       159

</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Finding-predictive-residues-and-structural-fragments">
<h2>Finding predictive residues and structural fragments<a class="headerlink" href="#Finding-predictive-residues-and-structural-fragments" title="Permalink to this headline">¶</a></h2>
<p>Since each shape-mer can be mapped back to the residues it describes, it’s easy to use Geometricus to determine predictive or functionally relevant residues and structural regions from a trained predictor (or from loadings generated from a method such as PCA). Such insights can be directly be applied to select candidate residues for mutational studies or used in directed evolution techniques to engineer proteins and enzymes with desired properties.</p>
<p>By inspecting the decision tree created above, it becomes clear that some shape-mers are present multiple times across a protein and the number of times differs across classes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">plot_tree</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">train_embedder</span><span class="o">.</span><span class="n">shapemer_keys</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/getting_started_17_0.png" src="_images/getting_started_17_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span>
<span class="n">predictive_feature_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/getting_started_18_0.png" src="_images/getting_started_18_0.png" />
</div>
</div>
<p>We can map back to the residues described by a shape-mer using the <code class="docutils literal notranslate"><span class="pre">map_shapemer_to_residues</span></code> function which returns a dictionary mapping each protein to the corresponding residue indices of the shape-mer within that protein, if it exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">shapemer</span> <span class="o">=</span> <span class="n">train_embedder</span><span class="o">.</span><span class="n">shapemer_keys</span><span class="p">[</span><span class="n">predictive_feature_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">residue_indices_train</span> <span class="o">=</span> <span class="n">train_embedder</span><span class="o">.</span><span class="n">map_shapemer_to_residues</span><span class="p">(</span><span class="n">shapemer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape-mer:&quot;</span><span class="p">,</span> <span class="n">shapemer</span><span class="p">,</span> <span class="s2">&quot;Number of proteins with shape-mer:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue_indices_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Residue indices per protein (for 10 proteins):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">residue_indices_train</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">residue_indices_train</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Shape-mer: (13, 24, 32, 34) Number of proteins with shape-mer: 507

Residue indices per protein (for 10 proteins):
(&#39;3o2m&#39;, &#39;A&#39;) {234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249}
(&#39;3o2m&#39;, &#39;B&#39;) {234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249}
(&#39;4eh8&#39;, &#39;A&#39;) {231, 232, 233, 234, 235, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119}
(&#39;4eh2&#39;, &#39;A&#39;) {230, 231, 232, 233, 234, 235, 236, 221, 222, 223, 224, 225, 226, 227, 228, 229, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119}
(&#39;4eh7&#39;, &#39;A&#39;) {224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 221, 222, 223}
(&#39;4eh5&#39;, &#39;A&#39;) {224, 225, 226, 227, 228, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223}
(&#39;4dli&#39;, &#39;A&#39;) {224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 218, 219, 220, 221, 222, 223}
(&#39;4eh3&#39;, &#39;A&#39;) {231, 232, 233, 234, 235, 236, 237, 238, 223, 224, 225, 226, 227, 228, 229, 230, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119}
(&#39;4eh6&#39;, &#39;A&#39;) {231, 232, 233, 234, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119}
(&#39;4eh4&#39;, &#39;A&#39;) {224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 221, 222, 223}
(&#39;4eh9&#39;, &#39;A&#39;) {224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 218, 219, 220, 221, 222, 223}
</pre></div></div>
</div>
<p>These residue indices can then be visualized on a protein structure using molecule visualization software such as PyMol. Comparing the same location in proteins which don’t have this shape-mer can also be informative.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Janani Durairaj, Mehmet Akdel.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/getting_started.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/TurtleTools/geometricus" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>